# 1. 微服务架构发展历程

## 微服务发展历程

    1999-2008 电子化信息化
    2008-2014 网络化移动化
    2014至今 数字化智能化

    不管是互联网，还是银行、证券、保险，业务越来越复杂，数据越来越多。
    系统对性能、稳定性，一致性，可用性，扩展性，可维护性，要求越来越高。

---

    单体架构

    简单单体模式是最简单的架构风格，所有的代码全都在一个项目中。这样研发团队的任何一个人都可以随时修改任意的一段代码，或者增加一些新的代码。

    垂直架构

    分层是一个典型的对复杂系 统(不仅仅是软件)进行结 构化思考和抽象聚合的通用 性办法，也符合金字塔原理。 MVC 是一个非常常见的 3 层 (3-Tier)结构架构模式。

    SOA架构

    面向服务架构(SOA)是 一种建设企业IT生态系统的 架构指导思想。SOA的关 注点是服务。服务最基本 的业务功能单元，由平台 中立性的接口契约来定义

    微服务架构

    微服务架构风格，以实现一 组微服务的方式来开发一个 独立的应用系统的方法。其 中每个小微服务都运行在自 己的进程中，一般采用 HTTP资源API这样轻量的机 制相互通信。

---

    • 2011 年 5 月威尼斯会议提出“微服务”
    • 2012 年 3 月 James Lewis 关于微服务原则的演讲
    • 2012 年 11 月 Fred George 提出“微服务架构”概念
    • 2014 年 3 月 Martin Flowler 全面介绍了微服务架构
    • 2016 年 4 月 JonasBonér 提出“响应式微服务架构”
    服务网格

## 微服务发展历程--1.响应式微服务

    • 响应式编程是一个专注于数据流和变化传递的异步编程范式。 -- 维基百科

## 微服务发展历程--2.服务网格与云原生

    将服务间的网络通信层及其控制策略下沉到基础设施，就形成了所谓的“服务网格”技术。 通过微服务、容器化、持续交付、Devops等技术，组成了所谓的“元原生”体系。

## 微服务发展历程--3.数据库网格

## 微服务发展历程--4.单元化架构

    以单元为组织架构，以单元化部署为调度单位。
    每个单元，是一个五脏俱全的缩小版整站，它是全能的，因为部署了所有应用;但它不是全量的，因为只能操作一部分数据。能够单元化的系统，很容易在多机房中部署，因为可以轻易地把几个单元部署在一个机房，而把另外几个部署在其他机房。通过在业务入口处设置一个流量调配器，可以调整业务流量在单元之间的比例。

## 微服务发展历程

    微服务 MicroServices
    服务网格 ServiceMesh
    数据库网格 DatabaseMesh
    云原生 Cloud-Native

    单元化架构 Cell Architecture

# 2. 微服务架构应用场景

## 什么时候用微服务呢?

    微服务应用在复杂度低的情况下， 生产力反而比单体架构低
    在复杂度高的地方，情况恰恰相反
    随着复杂度升高，单体架构的生产力快速下降，而微服务相对平稳，为什么?

---

    - 大规模复杂业务系统的架构升级与中台建设

# 3. 微服务架构最佳实践

## 六大最佳实践

    遗留系统改造
    恰当粒度拆分
    扩展立方体
    自动化管理
    分布式事务
    完善监控体系

## 最佳实践-01

    1功能剥离、数据解耦
    2自然演进、逐步拆分
    3小步快跑、快速迭代
    4灰度发布、谨慎试错
    5提质量线、还技术债

## 最佳实践-02

    拆分原则:
    1.高内聚低耦合
    2.不同阶段拆分要点不同

## 最佳实践-03

    扩展立方体:

    1. 水平复制:复制系统
    2. 功能解耦:拆分业务
    3. 数据分区:切分数据

    单元化架构的基础

    +特性开关 +容错设计

## 最佳实践-04

    自动化测试
    自动化部署
    自动化运维

    降低服务拆分带来的复杂性
    提升测试、部署、运维效率

## 最佳实践-05

    幂等/去重/补偿
    慎用分布式事务!

## 最佳实践-06

    监控与运维:
    1.业务监控
    2.系统监控
    3.容量规划
    4.报警预警
    5.运维流程
    6.故障处理

    稳定性建设
    +Devops +SRE

# 4. Spring Cloud 技术体系

## Spring Cloud

    - Config/Eureka/Consul
    - Zuul/Zuul2/Spring Cloud Gateway
    - Feign/Ribbon

    Feign的核心功能就是，作为HTTP Client访问REST服务接口。
    优势在于:
    1、全都基于注解，简单方便
    2、跟XXTemplate一样，内置了简化操作，OOP
    3、跟其他组件，ribbon，hytrix联合使用

    Ribbon是用于云环境的一个客户端内部通信(IPC)库。 特性:
    1、负载均衡
    2、容错
    3、多协议支持(HTTP, TCP, UDP)，特别是异步和反应式下
    4、缓存和批处理

    - Hytrix/Alibaba Sentinel

# 5.微服务相关框架与工具

## 相关工具-APM

    APM:应用性能监控 - Apache Skywalking - Pinpoint

    - Zipkin
    - Jaeger
      监控
    - ELK
    - promethus+Grafana MQ+时序数据库 (InfluxDB/openTSDB 等)

## 相关工具-APM:Apache Skywalking

## 相关工具-APM

    可观测性

    - Logging
    - Tracing
    - Metrics

    标准:

    - OpenTracing
    - OpenSensus
    - OpenTelemetry

## 相关工具-权限控制

    最核心的3A(其他:资源管理、安全加密等):
    - Authc: Authentication
    - Authz: Authorization
    - Audit

    CAS+SSO(TGT、ST)
    JWT/Token, OAuth2.0
    SpringSecurity, Apache Shiro

## 相关工具-数据处理

    1、读写分离与高可用 HA:
    2、分库分表 Sharding:
    3、分布式事务 DTX:
    4、数据迁移 Migration:
    5、数据集群扩容 Scaling:
    6、数据操作审计 Audit:

## 相关工具-网关与通信

    1、流量网关与WAF(Nginx/OR/Kong/Apisix)
    2、业务网关(Zuul/Zuul2/SCG)
    3、REST与其他协议之争(websocket/actor/rsocket/mq...)

# 6.总结回顾与作业实践

    第 20 课作业实践
    1、(选做)进度快的，把前几次课的选做题做做。
    2、(选做)进度慢的，把前几次课的必做题做做。
    3、(选做)学霸和课代表，，考虑多做做挑战题。

    缓冲一周，下周再战。
